<!DOCTYPE html>
<html lang="bn">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hey Nova ‚Äî Dip Edition</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#00ffb3" />
  <style>
    /* (CSS exactly as you already made ‚Äî glass UI) */
    /* For brevity I'm including compressed CSS - keep your long CSS if you like */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0
    }

    html,
    body {
      height: 100%
    }

    body {
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background: linear-gradient(180deg, #071021 0%, #071428 40%, #041126 100%);
      color: #e6f7ff;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 28px
    }

    .bg-blob {
      position: fixed;
      width: 420px;
      height: 420px;
      filter: blur(80px);
      opacity: .12;
      border-radius: 50%;
      z-index: 0;
      mix-blend-mode: screen
    }

    .blob-1 {
      background: radial-gradient(circle at 30% 30%, #00ffc2, #008cff 60%);
      top: -120px;
      left: -120px;
      animation: float1 12s ease-in-out infinite
    }

    .blob-2 {
      background: radial-gradient(circle at 70% 60%, #ffb86b, #ff6bcb 55%);
      bottom: -160px;
      right: -140px;
      animation: float2 14s ease-in-out infinite
    }

    @keyframes float1 {
      0% {
        transform: translate(0, 0)
      }

      50% {
        transform: translate(20px, 30px)
      }

      100% {
        transform: translate(0, 0)
      }
    }

    @keyframes float2 {
      0% {
        transform: translate(0, 0)
      }

      50% {
        transform: translate(-20px, -30px)
      }

      100% {
        transform: translate(0, 0)
      }
    }

    .card {
      position: relative;
      z-index: 2;
      width: 100%;
      max-width: 980px;
      min-height: 560px;
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0.02));
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(10px) saturate(120%);
      border: 1px solid rgba(255, 255, 255, 0.04);
      padding: 22px;
      display: grid;
      grid-template-columns: 360px 1fr;
      gap: 18px;
      overflow: hidden
    }

    .left {
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: center
    }

    .brand {
      width: 100%;
      display: flex;
      align-items: center;
      gap: 12px
    }

    .logo {
      width: 68px;
      height: 68px;
      border-radius: 14px;
      background: linear-gradient(135deg, #00ffb3, #2bd1ff);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #001422;
      font-size: 22px
    }

    .orb {
      margin-top: 8px;
      width: 220px;
      height: 220px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at 30% 30%, rgba(0, 255, 179, 0.06), rgba(0, 139, 255, 0.04));
      position: relative
    }

    .orb .ring {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      border: 3px solid rgba(0, 255, 179, 0.12);
      display: flex;
      align-items: center;
      justify-content: center;
      animation: pulse 2s infinite
    }

    .orb .mic {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: #00ffb3;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #002126;
      font-weight: 700;
      font-size: 20px;
      box-shadow: 0 6px 18px rgba(0, 255, 179, 0.12)
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
        opacity: .9
      }

      50% {
        transform: scale(1.12);
        opacity: .6
      }

      100% {
        transform: scale(1);
        opacity: .9
      }
    }

    .controls {
      width: 100%;
      display: flex;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
      justify-content: center
    }

    .btn {
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.05);
      padding: 10px 14px;
      border-radius: 12px;
      color: #e7fff9;
      cursor: pointer;
      display: inline-flex;
      gap: 8px;
      align-items: center;
      font-weight: 600;
      font-size: 14px
    }

    .btn.important {
      background: linear-gradient(90deg, #00ffb3, #2bd1ff);
      color: #001421;
      font-weight: 700
    }

    .small {
      font-size: 13px;
      color: #cfeff6;
      opacity: .9;
      margin-top: 8px;
      text-align: center
    }

    .right {
      display: flex;
      flex-direction: column;
      gap: 12px
    }

    .chatHeader {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px
    }

    #chatBox {
      height: 420px;
      overflow: auto;
      padding: 14px;
      border-radius: 12px;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.01), rgba(255, 255, 255, 0.005));
      border: 1px solid rgba(255, 255, 255, 0.02)
    }

    .bubble {
      max-width: 78%;
      padding: 10px 12px;
      margin: 8px 0;
      border-radius: 14px;
      line-height: 1.3;
      word-break: break-word
    }

    .bubble.user {
      background: linear-gradient(90deg, #053a54, #0b6b8f);
      color: #d7f7ff;
      margin-left: auto;
      border-bottom-right-radius: 4px
    }

    .bubble.nova {
      background: linear-gradient(90deg, #061a2a, #0e2b3f);
      color: #ffe9b8;
      border-bottom-left-radius: 4px
    }

    .inputRow {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-top: 6px
    }

    .textInput {
      flex: 1;
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.04);
      padding: 10px 12px;
      border-radius: 12px;
      color: #e6fff6
    }

    .foot {
      margin-top: 6px;
      font-size: 12px;
      color: #bfeef3;
      opacity: .85;
      text-align: center
    }

    @media (max-width:900px) {
      .card {
        grid-template-columns: 1fr;
        padding: 18px
      }
    }
  </style>
</head>

<body>
  <div class="bg-blob blob-1"></div>
  <div class="bg-blob blob-2"></div>
  <main class="card" role="main" aria-label="Nova AI Assistant">
    <section class="left">
      <div class="brand">
        <div class="logo">NV</div>
        <div>
          <h1>Hey Nova</h1>
          <p>Dip Edition ‚Ä¢ Personal AI companion</p>
        </div>
      </div>
      <div class="orb" title="Listening orb (touch mic to start)">
        <div class="ring" id="ring">
          <div class="mic" id="micBtn">üé§</div>
        </div>
      </div>
      <div class="controls">
        <button class="btn" id="btnMusic">üéµ Music</button>
        <button class="btn" id="btnTime">‚è∞ Time</button>
        <button class="btn important" id="btnGreet">üëã Greet</button>
      </div>
      <div class="small">Say <strong>"Hey Nova"</strong> or tap mic ‚Ä¢ Multilang (BN/EN/HI)</div>
    </section>
    <section class="right">
      <div class="chatHeader">
        <div>
          <div class="chatTitle">Conversation</div>
          <div class="sub">Nova listens, learns & adapts to your style</div>
        </div>
        <div style="text-align:right;font-size:12px;color:#bfeef3">Status: <span id="statusText">Idle</span></div>
      </div>
      <div id="chatBox" aria-live="polite" role="log"></div>
      <div class="inputRow">
        <input id="manualInput" class="textInput" placeholder="Type a message or press mic..." />
        <button class="btn" id="sendBtn">Send</button>
      </div>
      <div class="foot">Tip: say <em>"Nova, set reminder 8 am gym"</em> ‚Ä¢ Voice wake-word needs App install (APK)</div>
    </section>
  </main>

  <script>
    /*************************************************************************
     * Nova ‚Äî client side logic
     * - Voice (Web Speech API) for browsers
     * - Reminders (localStorage + Notifications)
     * - Emotion heuristics (simple)
     * - Memory (localStorage)
     * - Hooks to call backend AI (server endpoint)
     * - Passive listen loop (best-effort; for reliable wakeword use native Porcupine)
     *************************************************************************/
    const chatBox = document.getElementById('chatBox');
    const statusText = document.getElementById('statusText');
    const micBtn = document.getElementById('micBtn');
    const ring = document.getElementById('ring');
    const btnMusic = document.getElementById('btnMusic');
    const btnTime = document.getElementById('btnTime');
    const btnGreet = document.getElementById('btnGreet');
    const manualInput = document.getElementById('manualInput');
    const sendBtn = document.getElementById('sendBtn');

    // --- TTS setup ---
    const synth = window.speechSynthesis;
    let selectedVoice = null;
    function pickVoice() {
      const voices = synth.getVoices() || [];
      selectedVoice = voices.find(v => /female|woman|Google UK/i.test(v.name)) ||
        voices.find(v => v.lang && v.lang.startsWith('bn')) ||
        voices[0] || null;
    }
    if (synth.onvoiceschanged !== undefined) synth.onvoiceschanged = pickVoice;
    pickVoice();

    function speak(text, opts = {}) {
      if (!text) return;
      const u = new SpeechSynthesisUtterance(text);
      u.lang = 'bn-BD';
      u.text = text;
      u.rate = opts.rate ?? 1.0;
      u.pitch = opts.pitch ?? 1.03;
      if (selectedVoice) u.voice = selectedVoice;
      synth.cancel();
      synth.speak(u);
      appendNova(text);
    }

    // --- Chat display ---
    function appendUser(t) { const el = document.createElement('div'); el.className = 'bubble user'; el.textContent = t; chatBox.appendChild(el); chatBox.scrollTop = chatBox.scrollHeight; }
    function appendNova(t) { const el = document.createElement('div'); el.className = 'bubble nova'; el.textContent = t; chatBox.appendChild(el); chatBox.scrollTop = chatBox.scrollHeight; }

    // --- Speech Recognition (Web) ---
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recog = null;
    if (SpeechRecognition) {
      recog = new SpeechRecognition();
      recog.lang = 'bn-BD';
      recog.interimResults = false;
      recog.maxAlternatives = 1;
      recog.onstart = () => { statusText.textContent = 'Listening...'; ring.style.animationPlayState = 'running'; }
      recog.onend = () => { statusText.textContent = 'Idle'; ring.style.animationPlayState = 'paused'; }
      recog.onerror = (e) => { statusText.textContent = 'Error'; speak('‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶∞‡¶ø‡¶ï‡¶ó‡¶®‡¶ø‡¶∂‡¶®‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§'); }
      recog.onresult = (e) => { const t = e.results[0][0].transcript.trim(); appendUser(t); processCommand(t.toLowerCase()); }
    }

    let listening = false;
    function startListening() { if (!recog) { speak('‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ browser voice ‡¶∞‡¶ø‡¶ï‡¶ó‡¶®‡¶ø‡¶∂‡¶® ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ'); return; } try { recog.start(); listening = true; } catch (e) { } }
    function stopListening() { if (!recog) return; try { recog.stop(); } catch (e) { } listening = false; }

    // --- Passive listen (best-effort) ---
    function passiveListen() {
      if (!recog) return;
      try { recog.start(); } catch (e) { }
      recog.onresult = (e) => {
        const t = e.results[0][0].transcript.toLowerCase();
        if (t.includes('hey nova') || t.includes('‡¶®‡ßã‡¶≠‡¶æ') || t.includes('‡¶π‡ßá‡¶á ‡¶®‡ßã‡¶≠‡¶æ')) {
          speak('‡¶ú‡¶ø Dip bhai, ‡¶Ü‡¶Æ‡¶ø ‡¶Ü‡¶õ‡¶ø‡•§ ‡¶¨‡¶≤‡ßã ‡¶ï‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá?');
          startListening();
        }
      };
      recog.onend = () => { if (!listening) setTimeout(passiveListen, 500); };
    }

    // --- Simple emotion detection by words/tone (heuristic) ---
    function detectEmotion(text) {
      const sadWords = ['‡¶¶‡ßÅ‡¶É‡¶ñ', '‡¶¨‡¶ø‡¶∑‡¶æ‡¶¶', '‡¶è‡¶ï‡¶≤‡¶æ', '‡¶ï‡¶∑‡ßç‡¶ü', '‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶®‡ßá‡¶á'];
      const happyWords = ['‡¶π‡¶æ‡¶∏‡¶ø', '‡¶≠‡¶æ‡¶≤‡ßã', '‡¶ñ‡ßÅ‡¶∂‡¶ø', '‡¶õ‡¶ï‡ßç‡¶ï‡¶æ', '‡¶¶‡¶æ‡¶∞‡ßÅ‡¶£'];
      for (let w of sadWords) if (text.includes(w)) return 'sad';
      for (let w of happyWords) if (text.includes(w)) return 'happy';
      return 'neutral';
    }

    // --- Reminders: store in localStorage, show notification and speak ---
    function addReminder(hour, note) {
      const list = JSON.parse(localStorage.getItem('nova_reminders') || '[]');
      list.push({ hour, note, id: Date.now() });
      localStorage.setItem('nova_reminders', JSON.stringify(list));
      appendNova(`‡¶∞‡¶ø‡¶Æ‡¶æ‡¶á‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá ${hour} ‡¶ü‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‚Äî ${note}`);
    }
    function checkReminders() {
      const list = JSON.parse(localStorage.getItem('nova_reminders') || '[]');
      if (!list.length) return;
      const now = new Date(), h = now.getHours();
      list.forEach(r => {
        if (r._fired) return;
        if (r.hour === h) {
          speak('Reminder: ' + r.note);
          r._fired = true;
        }
      });
      localStorage.setItem('nova_reminders', JSON.stringify(list));
    }
    setInterval(checkReminders, 60 * 1000);

    // --- Minimal local "memory" ---
    function memorize(key, val) { const mem = JSON.parse(localStorage.getItem('nova_mem') || '{}'); mem[key] = val; localStorage.setItem('nova_mem', JSON.stringify(mem)); }
    function recall(key) { const mem = JSON.parse(localStorage.getItem('nova_mem') || '{}'); return mem[key]; }

    // --- Backend AI hook (optional) ---
    // Create your server that proxies OpenAI/Gemini (see server/server.js sample). Use fetch to call it.
    async function callBackendAI(prompt) {
      appendNova('‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶®‡ßá ‡¶≠‡¶æ‡¶¨‡¶õ‡¶ø... (demo)');
      try {
        const res = await fetch('/api/ai', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ prompt, user: 'dipbag' }) });
        if (!res.ok) throw new Error('AI failed');
        const data = await res.json();
        const text = data.reply || '‡¶ì‡¶™‡¶∞‡ßá ‡¶Ü‡¶≤‡¶æ‡¶™ ‡¶ö‡¶≤‡¶¨‡ßá ‡¶™‡¶∞‡ßá...';
        speak(text);
      } catch (e) {
        // fallback simple replies
        speak('‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶®‡ßá ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§ ‡¶Ü‡¶Æ‡¶ø ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡¶õ‡¶ø ‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶®‡ßá ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø ‡¶ï‡¶∞‡¶§‡ßá‡•§');
      }
    }

    // --- Command processing (core) ---
    function processCommand(cmd) {
      appendNova('Processing...');
      // wake
      if (/^(hey\s*nova|nova|‡¶®‡ßã‡¶≠‡¶æ|‡¶π‡ßá‡¶á ‡¶®‡ßã‡¶≠‡¶æ)/i.test(cmd)) { speak('‡¶ú‡¶ø ‡¶¨‡¶≤‡ßã Dip bhai!'); return; }

      // greeting shortcuts
      if (cmd.includes('‡¶™‡ßç‡¶∞‡¶£‡¶æ‡¶Æ') || cmd.includes('ram ram')) { speak('Ram Ram Dip bhai! ‡¶Ü‡¶ú‡¶ï‡ßá ‡¶ï‡ßÄ ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶®?'); return; }

      // time
      if (cmd.includes('‡¶∏‡¶Æ‡ßü') || cmd.includes('‡¶ï‡¶§‡¶ü‡¶æ') || cmd.includes('time')) { speak('‡¶è‡¶ñ‡¶® ‡¶∏‡¶Æ‡ßü ' + new Date().toLocaleTimeString('bn-BD')); return; }

      // music
      if (cmd.includes('‡¶ó‡¶æ‡¶®') || cmd.includes('music') || cmd.includes('play song')) { speak('‡¶ó‡¶æ‡¶® ‡¶ö‡¶æ‡¶≤‡¶æ‡¶ö‡ßç‡¶õ‡¶ø'); window.open('https://www.youtube.com/results?search_query=bengali+song', '_blank'); return; }

      // reminders
      if (cmd.includes('‡¶∞‡¶ø‡¶Æ‡¶æ‡¶á‡¶®‡ßç‡¶°') || cmd.includes('‡¶Æ‡¶®‡ßá')) { const m = cmd.match(/(\d{1,2})/); if (m) { addReminder(parseInt(m[1]), cmd); } else speak('‡¶ï‡ßã‡¶® ‡¶∏‡¶Æ‡ßü ‡¶Æ‡¶®‡ßá ‡¶ï‡¶∞‡¶æ‡¶§‡ßá ‡¶ö‡¶æ‡¶ì? ‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£: ‡¶Ü‡¶Æ‡¶æ‡¶ï‡ßá ‡ßÆ ‡¶ü‡¶æ‡ßü ‡¶∞‡¶ø‡¶Æ‡¶æ‡¶á‡¶®‡ßç‡¶° ‡¶ï‡¶∞‡ßã'); return; }

      // device actions (web level - can't call phone dial directly unless running in Android WebView & using bridge)
      if (cmd.includes('open camera') || cmd.includes('‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶ñ‡¶æ‡¶ì')) { speak('‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶ñ‡ßÅ‡¶≤‡¶õ‡¶ø'); /* on Android use native bridge */ return; }

      // emotion support
      if (cmd.includes('‡¶Æ‡¶® ‡¶ñ‡¶æ‡¶∞‡¶æ‡¶™') || cmd.includes('‡¶è‡¶ï‡¶æ‡¶ï‡ßÄ') || cmd.includes('‡¶ï‡¶∑‡ßç‡¶ü')) { speak('‡¶ö‡¶ø‡¶®‡ßç‡¶§‡¶æ ‡¶ï‡¶∞‡ßã ‡¶®‡¶æ Dip bhai, ‡¶Ü‡¶Æ‡¶ø ‡¶Ü‡¶õ‡¶ø‡•§ ‡¶è‡¶ï ‡¶ï‡¶æ‡¶™ ‡¶™‡¶æ‡¶®‡¶ø ‡¶®‡¶æ‡¶ì, deep breath ‡¶®‡¶æ‡¶ì ‚ù§'); return; }

      // memory set: "remember my name is X" (example)
      if (cmd.includes('‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ') || cmd.includes('i am')) { const name = cmd.replace(/.*(?:‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ|i am|i'm)\s*/i, '').trim(); if (name) { memorize('user_name', name); speak(`‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá ${name} ‚Äî ‡¶Ü‡¶Æ‡¶ø ‡¶Æ‡¶®‡ßá ‡¶∞‡¶æ‡¶ñ‡¶≤‡¶æ‡¶Æ`); } else speak('‡¶ï‡¶ø ‡¶Æ‡¶®‡ßá ‡¶∞‡¶æ‡¶ñ‡¶§‡ßá ‡¶¨‡¶≤‡¶õ‡ßã?'); return; }

      // fallback to backend AI if available
      callBackendAI(cmd);
    }

    // --- UI events ---
    micBtn.addEventListener('click', () => { if (!listening) startListening(); else stopListening(); });
    btnMusic.addEventListener('click', () => { speak('‡¶Æ‡¶ø‡¶â‡¶ú‡¶ø‡¶ï ‡¶ö‡¶æ‡¶≤‡¶æ‡¶ö‡ßç‡¶õ‡¶ø'); window.open('https://www.youtube.com/results?search_query=bengali+song', '_blank'); });
    btnTime.addEventListener('click', () => { speak('‡¶è‡¶ñ‡¶® ‡¶∏‡¶Æ‡ßü ' + new Date().toLocaleTimeString('bn-BD')); });
    btnGreet.addEventListener('click', () => { speak('üå∏ Ram Ram Dip bhai! ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ Nova ‡¶π‡¶æ‡¶ú‡¶ø‡¶∞. ‡¶Ü‡¶ú ‡¶ï‡ßá‡¶Æ‡¶® ‡¶Ü‡¶õ‡ßã?'); });

    sendBtn.addEventListener('click', () => { const t = manualInput.value.trim(); if (!t) return; appendUser(t); manualInput.value = ''; processCommand(t.toLowerCase()); });
    manualInput.addEventListener('keydown', e => { if (e.key === 'Enter') sendBtn.click(); });

    // initial greeting & start passive listen
    setTimeout(() => { appendNova('üå∏ Ram Ram Dip! ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ Nova ‡¶π‡¶æ‡¶ú‡¶ø‡¶∞. ‡¶¨‡¶≤‡ßã, ‡¶ï‡ßÄ ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá?'); }, 900);
    setTimeout(() => { passiveListen(); }, 1500);

    // Notifications permission for reminders
    if ('Notification' in window) { if (Notification.permission === 'default') Notification.requestPermission(); }

    // Service worker registration (optional offline caching)
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').catch(() => console.log('SW failed'));
    }

  </script>
</body>

</html>